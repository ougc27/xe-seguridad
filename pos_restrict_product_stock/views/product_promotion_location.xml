<?xml version='1.0' encoding='utf-8' ?>
<odoo>
    <record id="view_product_promotion_location_tree" model="ir.ui.view">
        <field name="name">product.promotion.location.tree</field>
        <field name="model">product.promotion.location</field>
        <field name="arch" type="xml">
            <tree string="Product Promotions by Location" editable="bottom" sample="1">
                <field name="product_id" options="{'no_open': True, 'no_create': True}"/>
                <field name="pricelist_ids" widget="many2many_tags" options="{'no_open': True, 'no_create': True}"/>
                <field name="warehouse_ids" widget="many2many_tags" options="{'no_open': True, 'no_create': True}"/>
                <field name="price_tax_included"/>
                <field name="date_start"/>
                <field name="date_end" required="date_start"/>
                <field name="company_id" options="{'no_open': True, 'no_create': True}"/>
            </tree>
        </field>
    </record>

    <record id="product_promotion_location_search_view" model="ir.ui.view">
        <field name="name">product.promotion.location.search.view</field>
        <field name="model">product.promotion.location</field>
        <field name="arch" type="xml">
            <search>
                <field name="product_id"/>
                <field name="warehouse_ids"/>
                <field name="pricelist_ids"/>
               <filter name="active_promotions"
                    string="Active Promotions"
                    domain="[
                        '|',
                            '&amp;',
                                '|',
                                    ('date_start', '=', False),
                                    ('date_start', '&lt;=', context_today()),
                                '|',
                                    ('date_end', '=', False),
                                    ('date_end', '&gt;=', context_today()),
                            '&amp;',
                                ('date_start', '=', False),
                                ('date_end', '=', False)
                    ]"
                    help="Currently active promotions"/>
                <filter name="expired_promotions"
                    string="Expired Promotions"
                    domain="[('date_end', '&lt;', context_today())]"
                    help="Promotions that have already expired"/>

                <separator/>
                <group expand="1" string="Group By">
                    <filter name="group_by_product_id"
                            string="Product"
                            context="{'group_by': 'product_id'}"/>
                    <filter name="group_by_warehouse_id"
                            string="Warehouse"
                            context="{'group_by': 'warehouse_ids'}"/>
                    <filter name="group_by_pricelist_ids"
                            string="Pricelists"
                            context="{'group_by': 'pricelist_ids'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_product_promotion_location" model="ir.actions.act_window">
        <field name="name">Product Promotions by Location</field>
        <field name="res_model">product.promotion.location</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_product_promotion_location_tree"/>
        <field name="context">{'search_default_active_promotions': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
            Create Product Promotion Location
            </p><p>
            Product promotion by warehouse location for change prices
            </p>
        </field>
        <field name="search_view_id" ref="product_promotion_location_search_view"/>
    </record>

    <menuitem id="pos_config_menu_product_promotion_location"
        name="Promotions by location"
        groups="product.group_product_pricelist"
        parent="point_of_sale.pos_config_menu_catalog"
        action="action_product_promotion_location"
        sequence="25"/>
</odoo>
