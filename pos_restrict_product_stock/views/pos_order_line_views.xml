<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_pos_order_line_tree_coupon_analysis" model="ir.ui.view">
        <field name="name">pos.order.line.tree.coupon.analysis</field>
        <field name="model">pos.order.line</field>
        <field name="arch" type="xml">
            <tree
                string="POS Order Lines with Coupons"
                create="false"
                delete="false"
                default_order="create_date desc"
            >
                <field name="create_date"/>
                <field name="order_id"/>
                <field name="product_id"/>
                <field name="qty"/>
                <field name="price_subtotal_incl"/>

                <field name="discount_price"/>
                <field name="coupon_id"/>

                <field name="program_id"/>
                <field name="user_id"/>
                <field name="config_id"/>

                <field name="company_id" optional="hide"/>
            </tree>
        </field>
    </record>
    <record id="view_pos_order_line_search_coupon_analysis" model="ir.ui.view">
        <field name="name">pos.order.line.search.coupon.analysis</field>
        <field name="model">pos.order.line</field>
        <field name="arch" type="xml">
            <search string="Search POS Order Lines">
                <field name="product_id"/>
                <field name="order_id"/>
                <field name="program_id"/>
                <field name="config_id"/>
                <field name="user_id"/>
                <field name="coupon_id"/>
                <field name="company_id"/>
                <filter
                    string="Today"
                    name="filter_today"
                    domain="[('create_date', '>=', context_today())]"
                />
                <filter
                    string="This Week"
                    name="filter_this_week"
                    domain="[
                        ('create_date', '>=', (datetime.datetime.combine(context_today() + relativedelta(weeks=-1,days=1,weekday=0), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S')),
                        ('create_date', '&lt;', (datetime.datetime.combine(context_today() + relativedelta(days=1,weekday=0), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S'))]"
                />
                <filter
                    string="This Month"
                    name="filter_this_month"
                    domain="[
                        ('create_date', '>=', (datetime.datetime.combine(context_today() + relativedelta(months=-1,days=1,weekday=0), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S')),
                        ('create_date', '&lt;', (datetime.datetime.combine(context_today() + relativedelta(days=1,weekday=0), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S'))]"
                />
                <separator/>
                <separator/>
                <filter name="filter_create_date" date="create_date"/>
                <group expand="0" string="Group By">
                    <filter
                        string="Create Date"
                        name="group_by_create_date"
                        context="{'group_by': 'create_date:day'}"
                    />
                    <filter
                        string="Order"
                        name="group_by_order"
                        context="{'group_by': 'order_id'}"
                    />
                    <filter
                        string="Product"
                        name="group_by_product"
                        context="{'group_by': 'product_id'}"
                    />
                    <filter
                        string="Coupon Program"
                        name="group_by_program"
                        context="{'group_by': 'program_id'}"
                    />
                    <filter
                        string="POS Config"
                        name="group_by_config"
                        context="{'group_by': 'config_id'}"
                    />
                    <filter
                        string="User"
                        name="group_by_user"
                        context="{'group_by': 'user_id'}"
                    />
                    <filter
                        string="Company"
                        name="group_by_company"
                        context="{'group_by': 'company_id'}"
                    />
                </group>
            </search>
        </field>
    </record>

    <record id="action_pos_order_line_with_coupons" model="ir.actions.act_window">
        <field name="name">Sales Order Lines with Coupons</field>
        <field name="res_model">pos.order.line</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_pos_order_line_tree_coupon_analysis"/>
        <field name="domain">[('coupon_id', '!=', False)]</field>
        <field name="search_view_id" ref="view_pos_order_line_search_coupon_analysis"/>
    </record>

    <menuitem
        id="menu_pos_order_lines_with_coupons"
        name="Sales Order Lines with Coupons"
        parent="point_of_sale.menu_point_of_sale"
        action="action_pos_order_line_with_coupons"
        groups="pos_restrict_product_stock.group_pos_advanced_user"
        sequence="3"
    />
</odoo>
