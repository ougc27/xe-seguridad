<odoo>
    <record id="custom_helpdesk_ticket_view_form" model="ir.ui.view">
        <field name="name">custom.helpdesk.ticket.form</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='email_cc']" position="replace">
                <field name="is_type_paint_or_function" invisible="1"/>
                <field name="sale_id" options="{'no_create':True, 'no_create_edit': True}"/>
                <field name="picking_id" 
                    options="{'no_create':True, 'no_create_edit': True}"
                    context="{'from_helpdesk_ticket': True}"
                    domain="['|', (not commercial_partner_id, '=', 1), ('partner_id', 'child_of', commercial_partner_id or []), ('company_id', '=', company_id)]"/>
                <field name="remission_date" invisible="not remission_date"/>
                <field name="remission_incident" invisible="not picking_id"/>
                <field name="complete_address"/>
                <field name="phone_number" widget="phone"/>
                <field name="product_id" domain="[('detailed_type', '=', 'product'), ('sale_ok', '=', True)]" options="{'no_create':True, 'no_create_edit': True}"/>
            </xpath>
            <xpath expr="//field[@name='tag_ids']" position="after">
                <field name="crm_team_id" invisible="not crm_team_id"/>
                <field name="warehouse_id" invisible="not warehouse_id"/>
                <field name="service_warehouse_id" invisible="not warehouse_id" options="{'no_create':True, 'no_create_edit': True}"/>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_create_edit': True}</attribute>
            </xpath>
            
            <xpath expr="//field[@name='ticket_type_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_create_edit': True}</attribute>
                <attribute name="required">1</attribute>
            </xpath>

            <xpath expr="//field[@name='partner_phone']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//label[@for='partner_phone']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <xpath expr="//div[@class='o_row o_row_readonly']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//page[@name='extra_info']/group[1]" position="after">
                <group name="inspection_and_corrections_group">
                    <group name="hardware_and_mechanism_issues">
                        <field name="mechanism_review"/>
                        <field name="accessory_install_pending"/>
                        <field name="accessory_delivery_pending"/>
                        <field name="spare_part_replacement"/>
                        <field name="loose_broken_gaskets"/>
                        <field name="damaged_interior_profile"/>
                        <field name="missing_caps"/>
                        <field name="customer_locked"/>
                        <field name="smart_lock_inspection"/>
                        <field name="smart_lock_replacement"/>
                    </group>
                    <group name="structural_and_finish_issues">
                        <field name="deficient_masonry"/>
                        <field name="loose_door_frame"/>
                        <field name="door_installation"/>
                        <field name="door_reinstallation"/>
                        <field name="door_replacement"/>
                        <field name="door_dent"/>
                        <field name="paint_factory_defect"/>
                        <field name="door_faded_paint"/>
                        <field name="rusty_paint"/>
                    </group>
                </group>
            </xpath>
            <xpath expr="//page[@name='extra_info']" position="after">
                <page string="Construction" name="builder_filling_page">
                    <group name="builder_details_group" col="2">
                        <field name="housing_type" required="crm_team_id == 6"/>
                        <field name="lot"/>
                        <field name="block"/>
                        <field name="subdivision"/>
                        <field name="architect"/>
                    </group>
                </page>
                <page string="Follow-up" name="followup">
                    <field name="call_ids" widget="one2many">
                        <tree editable="bottom">
                            <field name="interaction_date"/>
                            <field name="name"/>
                            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create':True, 'no_create_edit': True}"/>
                            <field name="user_id" options="{'no_create':True, 'no_create_edit': True, 'no_open': True}"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record id="helpdesk_ticket_view_form_button_inherit" model="ir.ui.view">
        <field name="name">helpdesk.helpdesk.ticket.form.button.inherit</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk_fsm.helpdesk_ticket_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_generate_fsm_task']" position="replace">
                <field name="service_picking_ids" invisible="1"/>
                <field name="show_transfer_button" invisible="1"/>
                <button name="action_open_transfer_wizard"
                        type="object"
                        string="Generate Transfer"
                        class="oe_highlight"
                        invisible="not show_transfer_button or not is_type_paint_or_function"
                        icon="fa-truck"/>
                <button name="autofill_from_picking_or_sale"
                    type="object"
                    string="Autofill Information"
                    invisible="not is_type_paint_or_function"
                    class="btn-secondary"
                    icon="fa-magic"/>
            </xpath>
            <xpath expr="//button[@name='action_view_fsm_tasks']" position="before">
                <button type="object"
                    name="action_open_service_picking_ids"
                    class="oe_stat_button"
                    icon="fa-truck"
                    invisible="not service_picking_ids">
                    Service Delivery
                </button>
            </xpath>
        </field>
    </record>
</odoo>
